---
title: "EDA - NFL play by play"
format: html
editor: visual
---



```{r}
library(tidyverse)
#Read in Data - delimiter is Csv. 
nfl_09_18 <- read_csv("NFL Play by Play 2009-2018 (v5).csv")
nfl_09_18




```

list the names to see what could be interesting to explore

```{r}
#list names of columns 

colnames(nfl_09_18)


```

EDA steps: Understand how the data is stored.

```{r}
str(nfl_09_18)
```

DO basic data validation and check that the mins/max etc all make sense

```{r}
install.packages("psych")
psych::describe(nfl_09_18)
```

Determine the rate of missing values

```{r}
colSums(is.na(nfl_09_18))
```

Adding season column so can explore each team over the seasons.

```{r}
library(tidyverse)
nfl_09_18 <- nfl_09_18 |>
  mutate(season = year(game_date))
            
```

Create a one-way contingency table investigating the frequency of the categorical variable play type.

```{r}
play_type <- table(nfl_09_18$play_type)
play_type
```

Notice from above that most plays are either a run or pass. Now I want to look at type of play by the down - this is a two-way contingency table

```{r}
type_by_down <- table(nfl_09_18$play_type, nfl_09_18$down)
type_by_down
```

As expected when we look at the table above we can see that most of the field goal attempts happen in the 4th down. We also expect that most punts happen in the 4th down which is shown here with only 2 occasions deviating from that expectation over 9 seasons. It is interesting to me that the number of runs decrease as the down increases, yet passing remains fairly evenly spread (with the excpetion of the 4th down for both passing and running). Next I am exploring the average yards gained for running vs passing play type.

```{r}
# Create a smaller version of the data set with just pass and run plays. 
nfl_small <- nfl_09_18 |>
  filter(play_type %in% c("run", "pass"), !is.na(down), down <= 4)
# Average yards gained for runs vs passes
nfl_small |>
  group_by(play_type) |>
  summarise(
    mean_yards = mean(yards_gained, na.rm = TRUE),
    median_yards = median(yards_gained, na.rm = TRUE),
    sd_yards = sd(yards_gained, na.rm = TRUE)
  )

```

Looking at the summaries above it is interesting to see that the average yards gained for passing is higher than for running. However, the SD for running the ball is much smaller suggesting it is much more stable. Both of the medians are close although passing beats running by one yard.

```{r}
nfl_small |>
  group_by(down, play_type_simple) |>
  summarise(
    mean_yards = mean(yards_gained, na.rm = TRUE),
    median_yards = median(yards_gained, na.rm = TRUE),
    sd_yards = sd(yards_gained, na.rm = TRUE),
    n = n()
  )
```

This table gives us the summaries for each play by each down.

### Histogram of yards gained by play type

This plot shows the distribution of yards gained for passing and running plays. Each facet represents a play type, and the histogram bars show play counts, overlaid with a smooth density curve. The dashed line shows the median yards gained, and the solid line shows the mean.

```{r}
library(tidyverse)

# keep run/pass only, trim extreme outliers for readability in plots (but not for stats)
nfl_runpass <- nfl_09_18 %>%
  filter(play_type %in% c("run","pass"))

# quick stats for ref lines
summ_ref <- nfl_runpass %>%
  group_by(play_type) %>%
  summarise(
    mean_yards   = mean(yards_gained, na.rm = TRUE),
    median_yards = median(yards_gained, na.rm = TRUE)
  )

ggplot(nfl_runpass, aes(x = yards_gained)) +
  geom_histogram(binwidth = 1,fill = "lightgray", boundary = 0, alpha = 0.9) +
  geom_density(aes(y = after_stat(count)), linewidth = 0.6, alpha = 0.6) +
  geom_vline(data = summ_ref, aes(xintercept = median_yards),color = "red", linetype = "dashed") +
  geom_vline(data = summ_ref, aes(xintercept = mean_yards),color="blue") +
    facet_wrap(~ play_type, nrow = 1, scales = "free_y") +
  coord_cartesian(xlim = c(-10, 25)) +  
  labs(
    title = "Distribution of Yards Gained by Play Type",
    subtitle = "Blue line = median, Red line = mean",
    x = "Yards gained",
    y = "Number of Plays"
  ) +
  theme_minimal(base_size = 12) +
  theme(panel.grid.minor = element_blank())

```

Passing plays have a much wider spread. Most pass plays gain between 0 and 10 yards, but there are lots of outliers that have 15+ yards or there are lots of occasions where there is negative yardage. Running plays are more tightly clustered. Most runs gain roughly 3–5 yards and there are relatively fewer extreme outcomes. The right-skew in both plots shows that while most plays gain only a few yards, a small number of plays result in long gains.

### Box Plots of Yards gained by play type

These box plots compare the median and spread of yards gained for run vs. pass plays

```{r}
ggplot(nfl_runpass, aes(x = play_type, y = yards_gained, fill = play_type)) +
  geom_boxplot(outlier.alpha = 0.15, width = 0.7) +
  coord_cartesian(ylim = c(-10, 25)) +
  labs(
    title = "Yards Gained by Play Type",
    x = "Play type",
    y = "Yards gained"
  ) +
  guides(fill = "none") +
  theme_minimal(base_size = 12)

```

The side by side box plots show that passing plays have a higher average and median yardage than running plays, but also much higher variability. Running plays are more consistent and the interquartile range is narrower. Passing plays occasionally produce large gains (and losses), as shown by the longer whiskers and more outliers. This matched what we would expect using football intuition: passes are higher-risk, higher-reward, while runs are steadier and lower variance.



### Looking at yards gained distribution over each season for passing 
```{r}
library(tidyverse)
library(lubridate)
library(ggridges)

nfl_pass <- nfl_09_18 |>
  filter(play_type == "pass",
         !is.na(yards_gained),
         between(yards_gained, -10, 40))


ggplot(nfl_pass, aes(x = yards_gained, y = factor(season),
                     fill = after_stat(x))) +
  geom_density_ridges_gradient(scale = 3,
                               rel_min_height = 0.003,
                               color = "black", size = 0.25)  +
  scale_fill_viridis_c(name = "Yards gained", option = "magma") +
  labs(title = "Passing Yards Gained by Season",
       subtitle = "Ridgeline density of yards gained on pass plays",
       x = "Yards gained (pass plays)", y = "Season") +
  theme_minimal(base_size = 13) +
  theme(panel.grid.minor = element_blank())
```
The ridgeline plot shows that the distribution of yards gained on pass plays remains fairly consistent across seasons from 2009 to 2018. Each season peaks around short gains of 5 yards, with similar right-skewed tails representing occasional long completions. This indicates that the average effectiveness of a pass play, measured by yards gained, did not substantially change over the nine-year period.


```{r}
library(tidyverse)
library(lubridate)
library(ggridges)

nfl_run <- nfl_09_18 |>
  filter(play_type == "run",
         !is.na(yards_gained),
         between(yards_gained, -10, 40))


ggplot(nfl_run, aes(x = yards_gained, y = factor(season),
                     fill = after_stat(x))) +
  geom_density_ridges_gradient(scale = 3,
                               rel_min_height = 0.003,
                               color = "black", size = 0.25)  +
  scale_fill_viridis_c(name = "Yards gained", option = "magma") +
  labs(title = "Running Yards Gained by Season",
       subtitle = "Ridgeline density of yards gained on running plays",
       x = "Yards gained run plays)", y = "Season") +
  theme_minimal(base_size = 13) +
  theme(panel.grid.minor = element_blank())
```
  The ridgeline plot for rushing yards shows a consistent, unimodal distribution across all seasons, with most runs gaining about 3–4 yards and occasional long gains. The near-identical shape of each density suggests that per-play rushing performance in the NFL remained remarkably stable from 2009 to 2018.
  
```{r}
nfl_09_18 |>
  filter(play_type == "run") |>
  group_by(season) |>
  summarise(
    mean_yards = mean(yards_gained, na.rm = TRUE),
    median_yards = median(yards_gained, na.rm = TRUE)
  )

```
  Across the 2009–2018 seasons, mean running yardage was remarkably consistent at about 4.3 yards per carry, with a stable median of 3 yards. The only exception occurred in 2018, when the mean increased to roughly 4.6 yards. Because the median remained unchanged, this rise was likely driven by a higher frequency of long, high-yardage runs rather than an across-the-board improvement in rushing efficiency.



```{r}
library(tidyverse)

# Filter only run and pass plays with valid values
nfl_time_scatter <- nfl_09_18 %>%
  filter(play_type %in% c("run", "pass"),
         !is.na(game_seconds_remaining),
         !is.na(yards_gained) )

# Basic scatter: yards gained vs time left
ggplot(nfl_time_scatter, aes(x = game_seconds_remaining / 60, y = yards_gained, color = play_type)) +
  geom_point(alpha = 0.05, size = 0.7) +
  scale_x_reverse() +  # so game start is on left, end (0 sec) on right
  labs(
    title = "Yards Gained vs. Time Remaining in Game",
    subtitle = "game start (60 min) to end (0 min)",
    x = "Minutes remaining in game",
    y = "Yards gained on play",
    color = "Play type"
  ) +
  theme_minimal(base_size = 13)

```
This scatter plot shows the raw distribution of yards gained across the full duration of the game, for both run and pass plays. Each point represents one play, with the x-axis indicating the minutes remaining (game start at 60, game end at 0).

The plot reveals that both play types are fairly consistent throughout the game in terms of typical yardage, with most plays clustered around 0–10 yards. Passing plays (red) display greater variability, extending to both large gains and larger losses, while runs (blue) are tightly grouped around short, positive gains.

There is a subtle widening of the spread near the end of games (toward 0 minutes), especially for pass plays — likely reflecting more aggressive play-calling late in games as teams attempt deeper passes or comeback drives.
## add one more plot maybe

```{r}
library(tidyverse)

nfl_violin <- nfl_09_18 %>%
  filter(play_type %in% c("run","pass"),
         !is.na(game_seconds_remaining),
         !is.na(yards_gained),
         yards_gained <= 40,  # trim long outliers
         yards_gained >= -10) %>%
  mutate(time_bin = cut(game_seconds_remaining/60,
                        breaks = seq(0, 60, by = 10),
                        labels = c("0–10","10–20","20–30","30–40","40–50","50–60"),
                        include.lowest = TRUE))

ggplot(nfl_violin, aes(x = time_bin, y = yards_gained, fill = play_type)) +
  geom_violin(trim = TRUE, alpha = 0.6) +
  facet_wrap(~ play_type, nrow = 2) +
  labs(
    title = "Distribution of Yards Gained by Time Remaining in Game",
    subtitle = "Each violin represents the distribution of yards gained within 10-minute time bins",
    x = "Minutes remaining in game",
    y = "Yards gained",
    fill = "Play type"
  ) +
  theme_minimal(base_size = 13) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

